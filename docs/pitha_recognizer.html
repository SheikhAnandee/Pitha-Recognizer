---
title: Pitha Recognizer
layout: page
---

<link rel="stylesheet" href="style.css">

<div class="recognizer-container">
  <h2>ü•Æ Pitha Recognizer</h2>
  <p>Upload an image of a Bangladeshi pitha and let AI identify it</p>

  <input id="photo" type="file" accept="image/*">

  <div id="results"></div>
</div>

<script type="module">
  import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/+esm";

  const photo = document.getElementById("photo");
  const results = document.getElementById("results");

  const client = await Client.connect("SheikhAnandee/pitha-recognizer");
  const CONFIDENCE_THRESHOLD = 0.75;

  photo.addEventListener("change", async () => {
    if (!photo.files.length) return;

    const file = photo.files[0];
    const imageURL = URL.createObjectURL(file);

    results.innerHTML = `
      <img src="${imageURL}">
      <p class="loading">üîç Analyzing image...</p>
    `;

    try {
      const result = await client.predict("/recognize_image", { image: file });
      const data = result.data;

      /*
        POSSIBLE DATA SHAPES:
        1) ["Patishapta"]
        2) [{ label: "Patishapta", confidence: 0.82 }]
        3) [[{ label, confidence }, { label, confidence }]]
      */

      let label = null;
      let confidence = null;

      // Case 1: simple label string
      if (typeof data[0] === "string") {
        label = data[0];
      }

      // Case 2: object with label
      else if (typeof data[0] === "object" && !Array.isArray(data[0])) {
        label = data[0].label;
        confidence = data[0].confidence ?? data[0].score ?? null;
      }

      // Case 3: array of predictions
      else if (Array.isArray(data[0])) {
        const top = data[0][0];
        label = top.label;
        confidence = top.confidence ?? top.score ?? null;
      }

      // If confidence exists and is low ‚Üí reject
      if (confidence !== null && confidence < CONFIDENCE_THRESHOLD) {
        results.innerHTML = `
          <img src="${imageURL}">
          <p class="prediction" style="color:red;">
            ‚ùå Prediction failed. Please try again.
          </p>
        `;
        return;
      }

      // If label is missing ‚Üí reject
      if (!label) {
        results.innerHTML = `
          <p class="prediction" style="color:red;">
            ‚ùå Prediction failed. Please try again.
          </p>
        `;
        return;
      }

      // Accept prediction
      results.innerHTML = `
        <img src="${imageURL}">
        <p class="prediction">
          ‚úÖ Predicted Pitha: <b>${label}</b>
          ${confidence !== null ? `<br>üî¢ Confidence: ${(confidence * 100).toFixed(1)}%` : ""}
        </p>
      `;

    } catch (error) {
      console.error(error);
      results.innerHTML = `
        <p class="prediction" style="color:red;">
          ‚ùå Prediction failed. Please try again.
        </p>
      `;
    }
  });
</script>
